# Manifest Utilities

This directory contains manifest-driven utilities for accessing TensorFlow/Keras components through generated JSON manifests.

## Purpose

These modules provide a thin abstraction layer between the Django REST API and TensorFlow/Keras, using JSON manifests as the single source of truth for component metadata.

## Modules

### `activations.py`

Utilities for activation function manifests:

- `list_activations()` - Get available activation functions
- `get_activation_entry()` - Get metadata for a specific activation
- `normalize_params_for_activation()` - Validate and normalize parameters
- `get_keras_activation()` - Get TensorFlow/Keras activation function reference
- `refresh_manifest()` / `regenerate_manifest()` - Update manifest data

### `layers.py`

Utilities for neural network layer manifests:

- `list_layers()` - Get available layer types
- `get_layer_entry()` - Get metadata for a specific layer
- `normalize_params_for_layer()` - Validate and normalize layer parameters
- `create_layer()` - Instantiate a Keras layer from configuration
- `refresh_manifest()` / `regenerate_manifest()` - Update manifest data

### `losses.py`

Utilities for loss function manifests:

- `list_losses()` - Get available loss functions
- `get_loss_entry()` - Get metadata for a specific loss
- `normalize_params_for_loss()` - Validate and normalize parameters
- `get_keras_loss()` - Get TensorFlow/Keras loss function reference
- `refresh_manifest()` / `regenerate_manifest()` - Update manifest data

### `metrics.py`

Utilities for evaluation metric manifests:

- `list_metrics()` - Get available metrics (with option to include/exclude base classes)
- `get_metric_entry()` - Get metadata for a specific metric
- `normalize_params_for_metric()` - Validate and normalize parameters
- `get_keras_metric()` - Get TensorFlow/Keras metric reference
- `refresh_manifest()` / `regenerate_manifest()` - Update manifest data

### `optimizers.py`

Utilities for training optimizer manifests:

- `list_optimizers()` - Get available optimizers
- `get_optimizer_entry()` - Get metadata for a specific optimizer
- `normalize_params_for_optimizer()` - Validate and normalize parameters
- `get_keras_optimizer()` - Get TensorFlow/Keras optimizer reference
- `refresh_manifest()` / `regenerate_manifest()` - Update manifest data

## How They Work

Each module follows the same pattern:

1. **Manifest Loading**: Loads JSON manifests from `../tensorflow_data/manifests/`
2. **Caching**: Manifests are cached in module-level `_MANIFEST` variable for performance
3. **Lookup**: Provides functions to query manifest data
4. **Validation**: Normalizes and validates parameters against manifest metadata
5. **Integration**: Creates TensorFlow/Keras objects from validated configurations

## Example Usage

```python
from network.manifests.layers import list_layers, get_layer_entry, create_layer

# Get all available layers
layers = list_layers(include_deprecated=False)
# Output: ['Dense', 'Conv2D', 'LSTM', ...]

# Get metadata for a specific layer
dense_info = get_layer_entry('Dense')
# Output: {'name': 'Dense', 'parameters': [...], ...}

# Create a Keras layer instance
layer = create_layer('Dense', {'units': 128, 'activation': 'relu'})
# Output: <Dense layer object>
```

## Integration with API

These modules are used by the ViewSets in `network/views/`:

- `LayerManifestViewSet` → `manifests.layers`
- `OptimizerManifestViewSet` → `manifests.optimizers`
- `LossManifestViewSet` → `manifests.losses`
- `MetricManifestViewSet` → `manifests.metrics`
- `ActivationManifestViewSet` → `manifests.activations`

## Manifest Data Source

All modules read from JSON files in `../tensorflow_data/manifests/`:

- `layer_manifest.json`
- `optimizer_manifest.json`
- `loss_manifest.json`
- `metric_manifest.json`
- `activation_manifest.json`

These manifests are generated by scripts in `../tensorflow_data/generators/`.

## Refreshing Manifests

Manifests can be refreshed without restarting the server:

```python
from network.manifests.optimizers import refresh_manifest

# Reload from disk (if manifest was regenerated)
refresh_manifest()

# Or regenerate and reload
from network.manifests.optimizers import regenerate_manifest
regenerate_manifest()
```

Or via API endpoints (admin only):

```bash
POST /api/network/optimizers/refresh-manifest/
POST /api/network/optimizers/regenerate-manifest/
```

## Parameter Normalization

All modules provide parameter normalization:

- **Filters unknown parameters** not in manifest
- **Validates required parameters** are present
- **Applies type checking** based on manifest metadata
- **Validates ranges** for numeric parameters
- **Validates enums** for categorical parameters
- **Omits None/empty values** to use Keras defaults

Example:

```python
from network.manifests.optimizers import normalize_params_for_optimizer

params = {
    'learning_rate': 0.001,
    'beta_1': 0.9,
    'unknown_param': 'ignored'  # Will be filtered out
}

normalized = normalize_params_for_optimizer('Adam', params)
# Output: {'learning_rate': 0.001, 'beta_1': 0.9}
```

## Design Principles

1. **Single Source of Truth**: Manifest JSON files contain all metadata
2. **Lazy Loading**: TensorFlow/Keras imported only when needed
3. **Error Handling**: Clear error messages for missing/invalid data
4. **Performance**: Module-level caching to avoid repeated file I/O
5. **Consistency**: All modules follow the same API pattern
